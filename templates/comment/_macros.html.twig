{% use '_layouts/comment.html.twig' %}

{% macro comment(comment, options) %}
  {%- with {
    comment: comment,
    level: 1,
    raw_body: options.raw_body ?? null,
    recurse: options.recurse ?? false,
    self: app.user,
    show_context: options.show_context ?? false,
    show_form: options.show_form ?? false,
  } only -%}
    {{- block('comment') -}}
  {%- endwith -%}
{% endmacro comment %}

{% macro comment_form(submission, parent) %}
  {% if submission.locked and not is_granted('ROLE_ADMIN') %}
    {% embed '_layouts/alert.html.twig' %}
      {% block alert_classes 'submission-locked-notice' %}
      {% block alert_paragraph 'flash.submission_is_locked'|trans %}
    {% endembed %}
  {% elseif is_granted('ROLE_USER') %}
    {{ render(controller('App\\Controller\\CommentController::commentForm', {
      forumName: submission.forum.name,
      submissionId: submission.id,
      commentId: parent.id ?? null
    })) }}
  {% else %}
    {% embed '_layouts/alert.html.twig' %}
      {% block alert_paragraph 'comments.not_logged_in'|trans({
        '%login_link%': '<a href="%s">%s</a>'|format(
          path('login'),
          'comments.not_logged_in_login_link_label'|trans
        ),
        '%register_link%': '<a href="%s">%s</a>'|format(
          path('registration'),
          'comments.not_logged_in_register_link_label'|trans
        ),
      })|raw %}
    {% endembed %}
  {% endif %}
{% endmacro comment_form %}
